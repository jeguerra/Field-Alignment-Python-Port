function ZI = bicutest(X,Y,Z,XI,YI)

iA = [1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;...
      0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0;...
     -3 3 0 0 -2 -1 0 0 0 0 0 0 0 0 0 0;...
      2 -2 0 0 1 1 0 0 0 0 0 0 0 0 0 0;...
      0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0;...
      0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0;...
      0 0 0 0 0 0 0 0 -3 3 0 0 -2 -1 0 0;...
      0 0 0 0 0 0 0 0 2 -2 0 0 1 1 0 0;...
     -3 0 3 0 0 0 0 0 -2 0 -1 0 0 0 0 0;...
      0 0 0 0 -3 0 3 0 0 0 0 0 -2 0 -1 0;...
      9 -9 -9 9 6 3 -6 -3 6 -6 3 -3 4 2 2 1;...
      -6 6 6 -6 -3 -3 3 3 -4 4 -2 2 -2 -2 -1 -1;...
      2 0 -2 0 0 0 0 0 1 0 1 0 0 0 0 0;...
      0 0 0 0 2 0 -2 0 0 0 0 0 1 0 1 0;...
     -6 6 6 -6 -4 -2 4 2 -3 3 -3 3 -2 -1 -2 -1;...
     4 -4 -4 4 2 2 -2 -2 2 -2 2 -2 1 1 1 1];

ZI = zeros(size(XI));

[dZx,dZy]=gradient(Z); 
[dZxx,dZxy] = gradient(dZx);
for i = 1:size(XI,1)
    for j = 1:size(XI,2)
       xc = XI(i,j);
       yc = YI(i,j);
       left= floor(xc);       right = ceil(xc);
       top = floor(yc);       bot = ceil(yc);
       v=[Z(top,left) Z(top,right) Z(bot,left) Z(bot,right)...
           dZx(top,left) dZx(top,right) dZx(bot,left) dZx(bot,right)...
           dZy(top,left) dZy(top,right) dZy(bot,left) dZy(bot,right)...
           dZxy(top,left) dZxy(top,right) dZxy(bot,left) dZxy(bot,right)];
       alph = iA*v';
       alpha = reshape(alph,[4 4]);
       dx = xc - left;
       dy = yc - top;
       val = 0;
       for kx = 0:3
           for ky = 0:3
               val = val+alpha(kx+1,ky+1)*dx^kx * dy^ky;
           end
       end
       ZI(i,j) = val;
    end
end

    
       
           

       
       